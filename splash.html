<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Oclon.bot</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Tajawal',sans-serif;}

html,body{
height:100%;
overflow:hidden;
background:#0a0e17;
}

.app{
width:100%;
height:100vh;
max-width:500px;
margin:auto;
display:flex;
flex-direction:column;
background:linear-gradient(180deg,#12182b 0%,#1a2340 100%);
position:relative;
overflow:hidden;
}

/* -- Splash Screen Styles -- */
.splash-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a1f2f, #0b0e1a);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    transition: opacity 0.5s ease-out;
    pointer-events: none;
}
.splash-screen.hidden {
    opacity: 0;
}
.splash-content {
    text-align: center;
    color: white;
}
.splash-content h1 {
    font-size: 42px;
    font-weight: 800;
    background: linear-gradient(135deg,#ffffff,#b886ff);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-bottom: 20px;
}
.splash-content p {
    color: #a5b3d9;
    font-size: 18px;
}
/* ------------------------- */

.header{
padding:15px;
text-align:center;
flex-shrink:0;
}

.title{
font-size:26px;
font-weight:800;
background:linear-gradient(135deg,#ffffff,#b886ff);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}

.main-content{
flex:1;
overflow-y:auto;
padding:10px 15px 90px 15px;
scrollbar-width:none;
}
.main-content::-webkit-scrollbar{display:none;}

.welcome-message{
text-align:center;
color:#a5b3d9;
margin-bottom:20px;
font-size:14px;
}

.coins-title{
color:#fff;
font-size:18px;
font-weight:700;
margin-bottom:15px;
}

.coins-grid{
display:flex;
flex-direction:column;
gap:12px;
}

.coin-card{
background:rgba(255,255,255,0.04);
border-radius:20px;
padding:15px;
display:flex;
align-items:center;
gap:12px;
cursor:pointer;
transition:.3s;
border:2px solid transparent;
}

.coin-card.selected{
border-color:#ffd966;
background:rgba(255,215,0,0.1);
}

.coin-card.voted{
opacity:.6;
pointer-events:none;
}

.coin-icon{
width:45px;
height:45px;
border-radius:50%;
overflow:hidden;
flex-shrink:0;
}

.coin-icon img{
width:100%;
height:100%;
}

.coin-name{
font-weight:700;
color:#fff;
}

.coin-symbol{
font-size:13px;
color:#a5b3d9;
}

/* ÙƒÙ„ ØªØºÙŠÙŠØ±: Ø²Ø± Ø§Ù„ØªØµÙˆÙŠØª ÙŠØ¸Ù‡Ø± Ù…Ø¨Ø§Ø´Ø±Ø© ØªØ­Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© */
.vote-options {
    display: none;
    justify-content: center;
    gap: 20px;
    margin: 10px 0 20px 0;  /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */
    width: 100%;
}

.vote-options.show {
    display: flex;
}

.vote-btn{
padding:12px 25px;
border-radius:50px;
font-weight:700;
cursor:pointer;
border:2px solid;
background:rgba(10,15,30,0.9);
}

.vote-up{border-color:#2ecc71;color:#2ecc71;}
.vote-down{border-color:#e74c3c;color:#e74c3c;}

/* ---- Profile Page Styles ---- */
.profile-card {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 30px;
    padding: 25px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.profile-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #8B5CF6, #EC4899);
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: white;
}

.profile-name {
    color: white;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 5px;
}

.profile-username {
    color: #8B5CF6;
    font-size: 14px;
    margin-bottom: 20px;
}

.profile-balance {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
}

.balance-label {
    color: #a5b3d9;
    font-size: 14px;
    margin-bottom: 5px;
}

.balance-amount {
    color: white;
    font-size: 32px;
    font-weight: 800;
}

.balance-amount span {
    font-size: 16px;
    color: #8B5CF6;
    margin-left: 5px;
}

.profile-actions {
    display: flex;
    gap: 15px;
}

.profile-action-btn {
    flex: 1;
    padding: 15px;
    border-radius: 20px;
    border: none;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
    background: rgba(255, 255, 255, 0.03);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.profile-action-btn.primary {
    background: linear-gradient(135deg, #8B5CF6, #EC4899);
    border: none;
}

.profile-action-btn:hover {
    transform: translateY(-2px);
}
/* -------------------------------------------- */

/* ---- Referral Page Styles ---- */
.referral-container {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 30px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.referral-title {
    color: white;
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 10px;
    text-align: center;
}

.referral-desc {
    color: #a5b3d9;
    font-size: 14px;
    text-align: center;
    margin-bottom: 25px;
    line-height: 1.5;
}

.referral-link-box {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
}

.referral-link-box input {
    flex: 1;
    padding: 15px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.03);
    color: white;
    font-size: 14px;
    direction: ltr;
}

.referral-link-box button {
    padding: 15px 25px;
    border-radius: 20px;
    border: none;
    background: linear-gradient(135deg, #8B5CF6, #EC4899);
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: 0.3s;
}

.referral-link-box button:hover {
    transform: scale(0.95);
}

.referral-stats-grid {
    display: flex;
    gap: 15px;
}

.referral-stat-item {
    flex: 1;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 20px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.referral-stat-number {
    color: white;
    font-size: 36px;
    font-weight: 800;
    margin-bottom: 5px;
}

.referral-stat-label {
    color: #a5b3d9;
    font-size: 14px;
}
/* -------------------------------------------- */

/* ---- Bottom Nav Glassmorphism ---- */
.bottom-nav {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    display: flex;
    justify-content: space-around;
    background: rgba(20, 25, 40, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 12px;
    border-radius: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.nav-item {
    color: #a5b3d9;
    text-align: center;
    cursor: pointer;
    font-size: 20px;
    transition: 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.nav-item span {
    font-size: 12px;
    font-weight: 500;
}

.nav-item.active {
    color: #8B5CF6;
    transform: translateY(-2px);
}

.nav-item.active span {
    color: #8B5CF6;
}
/* --------------------------------- */

.toast{
position:absolute;
bottom:100px;
left:50%;
transform:translateX(-50%);
background:#2ecc71;
color:#fff;
padding:10px 25px;
border-radius:50px;
opacity:0;
transition:.3s;
z-index: 200;
}

.toast.show{
opacity:1;
}

.hidden{display:none;}
</style>
</head>
<body>

<div class="app">

    <!-- splash screen -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-content">
            <h1>OCLIN BOT</h1>
            <p id="splashMessage">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

<div class="header">
<div class="title">OCLIN</div>
</div>

<div class="main-content">

<!-- HOME -->
<div id="homePage">
<div class="welcome-message">ğŸ‘‹ Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø© Ù„Ù„ØªØµÙˆÙŠØª</div>

<!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„Ø§Øª + Ø²Ø± Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ø°ÙŠ Ø³ÙŠÙ†ØªÙ‚Ù„ ØªØ­Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
<div id="coinsContainer">
    <div class="coins-title">ğŸ“Š Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</div>
    <div class="coins-grid" id="coinsGrid"></div>
    <!-- Ø²Ø± Ø§Ù„ØªØµÙˆÙŠØª Ø£ØµØ¨Ø­ Ù‡Ù†Ø§ Ø¯Ø§Ø®Ù„ containerØŒ ØªØ­Øª Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© -->
    <div class="vote-options" id="voteOptions">
        <div class="vote-btn vote-up" onclick="castVote('up')">â¬†ï¸ Up</div>
        <div class="vote-btn vote-down" onclick="castVote('down')">â¬‡ï¸ Down</div>
    </div>
</div>

</div>

<!-- PROFILE -->
<div id="profilePage" class="hidden">
<div class="profile-card">
    <div class="profile-avatar">ğŸ‘¤</div>
    <div class="profile-name">Random User</div>
    <div class="profile-username">@random_user</div>
    
    <div class="profile-balance">
        <div class="balance-label">Ø§Ù„Ø±ØµÙŠØ¯</div>
        <div class="balance-amount">
            <span id="profileBalance">0</span> <span>USD</span>
        </div>
    </div>
    
    <div class="profile-actions">
        <button class="profile-action-btn" onclick="showToast('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©')">Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©</button>
        <button class="profile-action-btn primary" onclick="showToast('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø§Ù„Ø³Ø­Ø¨')">Ø³Ø­Ø¨</button>
    </div>
</div>
</div>

<!-- REFERRAL -->
<div id="referralPage" class="hidden">
<div class="referral-container">
    <h2 class="referral-title">ğŸ Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
    <p class="referral-desc">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 5 Ù†Ù‚Ø§Ø· Ø¹Ù† ÙƒÙ„ ØµØ¯ÙŠÙ‚ ÙŠÙ†Ø¶Ù… Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø·Ùƒ</p>
    
    <div class="referral-link-box">
        <input type="text" id="referralLink" readonly>
        <button onclick="copyReferralLink()">Ù†Ø³Ø®</button>
    </div>
    
    <div class="referral-stats-grid">
        <div class="referral-stat-item">
            <div class="referral-stat-number" id="totalReferrals">0</div>
            <div class="referral-stat-label">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</div>
        </div>
        <div class="referral-stat-item">
            <div class="referral-stat-number" id="referralBalance">0</div>
            <div class="referral-stat-label">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
        </div>
    </div>
</div>
</div>

</div>

<!-- NAV -->
<div class="bottom-nav">
<div class="nav-item active" onclick="showPage('home', event)">
    ğŸ 
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
</div>
<div class="nav-item" onclick="showPage('profile', event)">
    ğŸ‘¤
    <span>Ø§Ù„Ù…Ù„Ù</span>
</div>
<div class="nav-item" onclick="showPage('referral', event)">
    â†—ï¸
    <span>Ø§Ù„Ø¯Ø¹ÙˆØ©</span>
</div>
</div>

<div class="toast" id="toast"></div>

</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
if(window.Telegram.WebApp){
Telegram.WebApp.expand();
Telegram.WebApp.disableVerticalSwipes();
}

const DAILY_LIMIT = 5;
const VOTE_REWARD = 10;
const REFERRAL_REWARD = 5;

// Ù…ØªØºÙŠØ±Ø§Øª ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª Ù„Ù„Ø¹Ù…Ù„Ø§Øª
let cachedCoins = [];
let isFetchingCoins = false;
let lastFetchTime = 0;
const CACHE_DURATION = 60000; // Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©

function playSound() {
    try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.2);
    } catch (e) {
        console.log("Audio not supported or blocked.");
    }
}

let userData = JSON.parse(localStorage.getItem("oclin_user")) || {
    id: "user_" + Math.random().toString(36).substr(2, 9),
    balance: 0,
    dailyVotes: 0,
    votedCoins: {},
    referralBalance: 0,
    referralsCount: 0,
    hasReceivedReferralReward: false
};

function checkForReferral() {
    const urlParams = new URLSearchParams(window.location.search);
    const referrerId = urlParams.get('ref');

    if (referrerId) {
        const isNewUser = !localStorage.getItem("oclin_user");

        if (isNewUser && !userData.hasReceivedReferralReward) {
            giveReferralReward(referrerId);
            userData.hasReceivedReferralReward = true;
            document.getElementById('splashMessage').innerText = 'ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹! ØªÙ… ØªÙØ¹ÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­';
            localStorage.setItem("oclin_user", JSON.stringify(userData));
            playSound();
        } else {
            document.getElementById('splashMessage').innerText = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!';
            if (!userData.hasOwnProperty('hasReceivedReferralReward')) {
                userData.hasReceivedReferralReward = true;
                localStorage.setItem("oclin_user", JSON.stringify(userData));
            }
        }
    } else {
        document.getElementById('splashMessage').innerText = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!';
    }
}

function giveReferralReward(referrerId) {
    let referrerData = JSON.parse(localStorage.getItem("referrer_" + referrerId));
    
    if (referrerData) {
        referrerData.referralBalance = (referrerData.referralBalance || 0) + REFERRAL_REWARD;
        referrerData.referralsCount = (referrerData.referralsCount || 0) + 1;
        localStorage.setItem("referrer_" + referrerId, JSON.stringify(referrerData));
    } else {
        const newReferrerData = {
            id: referrerId,
            referralBalance: REFERRAL_REWARD,
            referralsCount: 1
        };
        localStorage.setItem("referrer_" + referrerId, JSON.stringify(newReferrerData));
    }
}

function mergeReferralDataWithUser() {
    const storedReferralData = localStorage.getItem("referrer_" + userData.id);
    if (storedReferralData) {
        const refData = JSON.parse(storedReferralData);
        userData.referralBalance = refData.referralBalance || 0;
        userData.referralsCount = refData.referralsCount || 0;
    } else {
        userData.referralBalance = userData.referralBalance || 0;
        userData.referralsCount = userData.referralsCount || 0;
    }
    localStorage.setItem("oclin_user", JSON.stringify(userData));
}

let selectedIndex = -1;
const coinsGrid = document.getElementById("coinsGrid");
const voteOptions = document.getElementById("voteOptions");

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
async function fetchCoins(forceRefresh = false) {
    // Ù…Ù†Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
    if (isFetchingCoins) return;
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ†Ø§ ÙƒØ§Ø´ ÙˆÙ…Ø§ Ø·Ù„Ø¨Ù†Ø§ ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ø±ÙŠØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø´
    if (!forceRefresh && cachedCoins.length > 0 && (Date.now() - lastFetchTime) < CACHE_DURATION) {
        displayCoins(cachedCoins);
        return;
    }
    
    try {
        isFetchingCoins = true;
        
        // Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù„Ø·ÙŠÙØ©
        coinsGrid.innerHTML = '<p style="color:white;text-align:center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª...</p>';
        
        const res = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=15&page=1");
        
        if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        const data = await res.json();
        
        // ØªØ®Ø²ÙŠÙ† ÙÙŠ Ø§Ù„ÙƒØ§Ø´
        cachedCoins = data;
        lastFetchTime = Date.now();
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
        displayCoins(data);
        
    } catch (error) {
        console.error("Error fetching coins:", error);
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ†Ø§ ÙƒØ§Ø´ØŒ Ù†Ø¹Ø±Ø¶Ù‡ Ø­ØªÙ‰ Ù„Ùˆ Ù‚Ø¯ÙŠÙ…
        if (cachedCoins.length > 0) {
            displayCoins(cachedCoins);
            showToast("Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©");
        } else {
            coinsGrid.innerHTML = '<p style="color:white;text-align:center;">âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>';
        }
    } finally {
        isFetchingCoins = false;
    }
}

// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
function displayCoins(coins) {
    if (!coins || coins.length === 0) {
        coinsGrid.innerHTML = '<p style="color:white;text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Øª Ù…ØªØ§Ø­Ø©</p>';
        return;
    }
    
    coinsGrid.innerHTML = "";
    coins.forEach((coin, i) => {
        const div = document.createElement("div");
        div.className = "coin-card";
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØµÙˆÙŠØª
        if (userData.votedCoins && userData.votedCoins[i]) {
            div.classList.add("voted");
        }

        div.innerHTML = `
            <div class="coin-icon"><img src="${coin.image}" alt="${coin.name}" onerror="this.src='https://via.placeholder.com/45'"></div>
            <div>
                <div class="coin-name">${coin.name}</div>
                <div class="coin-symbol">${coin.symbol.toUpperCase()}</div>
            </div>`;

        div.onclick = () => selectCoin(i, div);
        coinsGrid.appendChild(div);
    });
}

function selectCoin(i, el) {
    if (userData.votedCoins && userData.votedCoins[i]) {
        showToast("Ù„Ù‚Ø¯ ØµÙˆØªØª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹");
        return;
    }
    
    document.querySelectorAll(".coin-card").forEach(c => c.classList.remove("selected"));
    el.classList.add("selected");
    selectedIndex = i;
    voteOptions.classList.add("show");
}

function castVote(voteType) {
    if (selectedIndex === -1) {
        showToast("Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹");
        return;
    }
    
    if (userData.dailyVotes >= DAILY_LIMIT) {
        showToast("Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ°Øª Ø­Ø¯ Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„ÙŠÙˆÙ…ÙŠ");
        return;
    }
    
    // Ø­ÙØ¸ Ø§Ù„ØªØµÙˆÙŠØª
    userData.balance += VOTE_REWARD;
    userData.dailyVotes++;
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ votedCoins
    if (!userData.votedCoins) {
        userData.votedCoins = {};
    }
    userData.votedCoins[selectedIndex] = true;
    
    localStorage.setItem("oclin_user", JSON.stringify(userData));
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    document.getElementById("profileBalance").innerText = userData.balance;
    showToast(`âœ… ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª Ø¨Ù†Ø¬Ø§Ø­! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${VOTE_REWARD} Ù†Ù‚Ø§Ø·`);
    
    // Ø¥Ø®ÙØ§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØµÙˆÙŠØª
    voteOptions.classList.remove("show");
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯
    document.querySelectorAll(".coin-card").forEach(c => c.classList.remove("selected"));
    selectedIndex = -1;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø´
    displayCoins(cachedCoins);
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø±)
    setTimeout(() => {
        if (Date.now() - lastFetchTime > 30000) { // Ø¥Ø°Ø§ Ù…Ø± 30 Ø«Ø§Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
            fetchCoins(true);
        }
    }, 1000);
}

function showPage(page, event) {
    if (event) {
        document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));
        event.currentTarget.classList.add("active");
    }

    document.getElementById("homePage").classList.add("hidden");
    document.getElementById("profilePage").classList.add("hidden");
    document.getElementById("referralPage").classList.add("hidden");

    document.getElementById(page + "Page").classList.remove("hidden");
    
    if (page === 'referral') {
        updateReferralDisplay();
    } else if (page === 'home') {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ØªØ¸Ù‡Ø± ÙÙˆØ±Ù‹Ø§ Ù…Ù† Ø§Ù„ÙƒØ§Ø´)
        if (cachedCoins.length > 0) {
            displayCoins(cachedCoins);
        } else {
            fetchCoins();
        }
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ vote options Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        voteOptions.classList.remove("show");
        selectedIndex = -1;
    }
}

function showToast(msg) {
    const t = document.getElementById("toast");
    t.innerText = msg;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 2000);
}

function copyReferralLink() {
    const linkInput = document.getElementById("referralLink");
    linkInput.select();
    linkInput.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(linkInput.value).then(() => {
        showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!");
    }).catch(err => {
        showToast("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®");
    });
}

function updateReferralDisplay() {
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„ÙŠÙƒÙˆÙ† deep link Ø¯Ø§Ø®Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ÙŠØ¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª
    const botUsername = "oclin_bot"; // Ø¶Ø¹ Ù…Ø¹Ø±Ù Ø§Ù„Ø¨ÙˆØª Ù‡Ù†Ø§
    document.getElementById("referralLink").value = "https://t.me/" + botUsername + "?start=" + userData.id;
    document.getElementById("referralBalance").innerText = userData.referralBalance;
    document.getElementById("totalReferrals").innerText = userData.referralsCount;
}

function init() {
    checkForReferral();
    mergeReferralDataWithUser();
    
    document.getElementById("profileBalance").innerText = userData.balance;
    updateReferralDisplay();
    
    // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    fetchCoins();
    
    setTimeout(() => {
        document.getElementById('splashScreen').classList.add('hidden');
    }, 2000);
}

document.addEventListener("DOMContentLoaded", init);

</script>

</body>
</html>
